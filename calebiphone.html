<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>S.P.A.D.E. ‚Äì Blazin Turtles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://unpkg.com/@mapbox/leaflet-pip@latest/leaflet-pip.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --primary-green: #1a5d1a;
      --accent-green: #27ae60;
      --bg-light: #e8f5e9;
      --card-bg: #f9f6f2;
      --border-color: #cbd5e0;
      --text-main: #2d3436;
      --soft-radius: 16px; /* Slightly rounder for iOS feel */
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    body { 
      margin: 0; 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
      background: var(--bg-light); 
      color: var(--text-main); 
      overflow: hidden; 
      height: 100vh;
    }

    /* Primary Layout Container */
    #wrap { 
      display: grid; 
      grid-template-columns: 550px 1fr; 
      height: 100vh; 
    }

    /* Sidebar/Scrollable Content */
    #sidebar { 
      padding: 20px; 
      padding-top: calc(20px + var(--safe-top));
      border-right: 1px solid var(--border-color); 
      overflow-y: auto; 
      background: var(--bg-light); 
      z-index: 10; 
      -webkit-overflow-scrolling: touch;
    }

    #map-container { 
      position: relative; 
      height: 100%; 
      width: 100%; 
    }

    #map { height: 100%; width: 100%; }

    /* Mobile Bottom Navigation */
    .mobile-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: calc(60px + var(--safe-bottom));
      background: white;
      border-top: 1px solid var(--border-color);
      z-index: 10000;
      grid-template-columns: 1fr 1fr;
      padding-bottom: var(--safe-bottom);
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      color: #718096;
      border: none;
      background: none;
      cursor: pointer;
    }

    .nav-item.active { color: var(--accent-green); }

    /* Typography & Buttons */
    h1 { font-size: 2.2em; margin-bottom: 5px; color: var(--primary-green); }
    .btn-standard { 
      min-height: 48px; 
      border-radius: var(--soft-radius); 
      font-size: 16px; /* Prevents iOS auto-zoom on focus */
      margin-bottom: 12px; 
    }
    input, select { 
      min-height: 44px; 
      font-size: 16px; 
      border-radius: 10px;
    }

    /* iPhone-specific Breakpoints */
    @media (max-width: 900px) {
      #wrap { grid-template-columns: 1fr; }
      #sidebar { 
        position: absolute; 
        top: 0; left: 0; right: 0; bottom: 60px; 
        width: auto; 
        border-right: none;
        padding-bottom: 80px;
      }
      #map-container { 
        position: absolute; 
        top: 0; left: 0; right: 0; bottom: 60px; 
        z-index: 5;
        display: none; /* Hidden by default, toggled via nav */
      }
      .mobile-nav { display: grid; }
      
      #map-container.active-view { display: block; }
      #sidebar.active-view { display: block; }
      #sidebar.hidden-view { display: none; }
    }

    /* Plant Card Mobile Optimization */
    .plant-card { padding: 15px; border-radius: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
    .plant-img { height: 180px; border-radius: 12px; }

  </style>
</head>
<body>

<div class="mobile-nav">
  <button class="nav-item active" id="nav-list" onclick="switchView('list')">
    <span style="font-size:20px;">üåø</span>
    <span>Plants</span>
  </button>
  <button class="nav-item" id="nav-map" onclick="switchView('map')">
    <span style="font-size:20px;">üìç</span>
    <span>Map</span>
  </button>
</div>

<div id="starred-overlay">
  <button class="close-overlay" onclick="closeStarred()">‚úï</button>
  <h2 style="color:white; text-align:center;">Starred</h2>
  <div id="starred-grid" class="overlay-grid"></div>
</div>

<div id="wrap">
  <div id="sidebar" class="active-view">
    <h1>S.P.A.D.E.</h1>
    <div class="acronym">Site Preservation and Dirt Erosion-control</div>
    <div class="subtitle">By Blazin Turtles</div>

    <div style="display:flex; flex-direction:column; gap:10px; margin-bottom:20px;">
        <button id="geo-btn" class="btn-standard" onclick="useMyLocation()">üìç Use My Location</button>
        <div class="input-row">
            <input type="text" id="zip-input" placeholder="Zip Code" maxlength="5">
            <button class="action-btn" onclick="useZipCode()">Go</button>
        </div>
    </div>

    <div style="background: white; padding: 15px; border-radius: 16px; margin-bottom: 20px; border: 1px solid #ddd;">
      <label style="color: #1e40af;">Region</label>
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div id="selected-region" style="font-weight: 700;">None Selected</div>
        <button id="clear-btn" onclick="resetAllData()" style="padding:8px; border-radius:8px;">Clear</button>
      </div>
    </div>

    <button class="btn-standard" style="background: #f1c40f;" onclick="openStarred()">‚≠ê Starred Plants</button>

    <h3>Filters</h3>
    <div class="filter-grid">
        <div class="row"><label>Plant Type</label><select id="type-filter" class="p-filter"><option value="all">All</option></select></div>
        <div class="row"><label>Sunlight</label><select id="sun-filter" class="p-filter"><option value="all">All</option></select></div>
    </div>

    <input type="text" id="main-search-box" placeholder="Search plants..." />
    <div id="results-count">Scanning...</div>
    <div id="plant-list"></div>
    <button id="show-more-btn" class="btn-standard" onclick="showMore()">Show More</button>
  </div>

  <div id="map-container">
    <div id="map-toggle-container">
      <button id="layer-toggle" class="toggle-map-btn" onclick="toggleMapLayer()">Satellite</button>
    </div>
    <div id="map"></div>
  </div>
</div>

<script>
  // ... Keep all your original Logic (init, PapaParse, Leaflet, syncLocation, etc.) ...
  
  // New UI Logic for Mobile Switching
  function switchView(view) {
    const sidebar = document.getElementById('sidebar');
    const mapContainer = document.getElementById('map-container');
    const navList = document.getElementById('nav-list');
    const navMap = document.getElementById('nav-map');

    if (view === 'list') {
      sidebar.classList.add('active-view');
      sidebar.classList.remove('hidden-view');
      mapContainer.classList.remove('active-view');
      navList.classList.add('active');
      navMap.classList.remove('active');
    } else {
      sidebar.classList.add('hidden-view');
      sidebar.classList.remove('active-view');
      mapContainer.classList.add('active-view');
      navMap.classList.add('active');
      navList.classList.remove('active');
      // Force leaflet to recalculate size when map becomes visible
      setTimeout(() => { map.invalidateSize(); }, 200);
    }
  }

  // Ensure you include the rest of your original functions here (loadGeoJSON, renderResults, etc.)
  // I have omitted them here to keep the response concise, but they should be pasted back in!
</script>
</body>
</html>